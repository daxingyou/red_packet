{{ template "weixin_header" }}
<div class="alert alert-info alert-dismissable" role="alert">
    <button class="close" type="button" onclick="$('.alert').eq(0).hide();">&times;</button>
    <span></span>
</div>
<!--顶部 导航栏部分-->
<nav class="nav navbar-default navbar-mystyle navbar-fixed-top">
    <div class="navbar-header">
        <span><a href="/weixin/" style="font-family: 微软雅黑;font-size: 2rem;line-height: 50px;margin-left: 2rem;font-weight: bold;color: darkgrey">动点游戏</a></span>
        <button class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <!--<a class="navbar-brand mystyle-brand" href="#"><span class="glyphicon glyphicon-home"></span></a>-->
    </div>
    <div class="collapse navbar-collapse" style="background-color: #394555;">
        <ul class="nav navbar-nav pull-right">
            <!--<li class="dropdown li-border" id="oSpan"><a href="#" class="dropdown-toggle mystyle-color" data-toggle="dropdown">选择游戏后台<span class="caret"></span></a>-->
            <!--<ul class="dropdown-menu" id="choseGame">-->
            <!--</ul>-->
            <!--</li>-->
            <li class="dropdown li-border"><a href="#" class="dropdown-toggle mystyle-color" data-toggle="dropdown"><span id="userNick">{{.wx_user.Nickname}}</span><span class="caret"></span></a>
                <ul class="dropdown-menu">
                    <li><a href="#" id="logout">退出</a></li>
                </ul>
            </li>
        </ul>
    </div>
</nav>
<!--左侧菜单栏部分-->
<div class="down-main">
    <div class="left-main left-off">
        <div class="sidebar-fold"><span class="glyphicon glyphicon-menu-hamburger"></span></div>
        <div class="subNavBox">
            <div class="sBox">
                <ul class="navContent" style="display:block">
                    <li>
                        <div class="showtitle" style="width:100px;">首页</div>
                        <a href="/weixin/agent"><span class="sublist-icon glyphicon glyphicon-home"></span><span class="sub-title">首页</span></a></li>
                    <li>
                        <div class="showtitle" style="width:100px;">出售</div>
                        <a href="/weixin/agent/sales"><span class="sublist-icon glyphicon glyphicon-tag"></span><span class="sub-title">出售</span></a></li>
                    <li>
                        <div class="showtitle" style="width:100px;">充值</div>
                        <a href="/weixin/agent/recharge"><span class="sublist-icon glyphicon glyphicon-shopping-cart"></span><span class="sub-title">充值</span></a></li>
                    <li>
                        <div class="showtitle" style="width:100px;">充值记录</div>
                        <a href="/weixin/agent/recharge/log"><span class="sublist-icon glyphicon glyphicon-time"></span><span class="sub-title">充值记录</span></a></li>
                    <li>
                        <div class="showtitle" style="width:100px;">出售记录</div>
                        <a href="/weixin/agent/sales/log"><span class="sublist-icon glyphicon glyphicon-star-empty"></span><span class="sub-title">出售记录</span></a></li>
                    <li>
                        <div class="showtitle" style="width:100px;">我的客户</div>
                        <a href="/weixin/agent/customers"><span class="sublist-icon glyphicon glyphicon-user"></span><span class="sub-title">我的客户</span></a></li>
                    <li>
                    <li class="active">
                        <div class="showtitle" style="width:100px;">代理审核</div>
                        <a href="/weixin/agent/apply/log"><span class="sublist-icon glyphicon glyphicon-user"></span><span class="sub-title">代理审核</span></a></li>
                    <li>
                        <div class="showtitle" style="width:100px;">我的代理</div>
                        <a href="/weixin/agent/my_agents"><span class="sublist-icon glyphicon glyphicon-user"></span><span class="sub-title">我的代理</span></a></li>
                    <li>
                        <div class="showtitle" style="width:100px;">返利记录</div>
                        <a href="/weixin/agent/rebate/log"><span class="sublist-icon glyphicon glyphicon-star-empty"></span><span class="sub-title">返利记录</span></a></li>
                </ul>
            </div>
        </div>
    </div>
    <!--右侧主体部分-->
    <div class="right-product my-index right-off">
        <div class="container-fluid">
            <div class="info-center">
                <div class="page-header">
                    <div class="pull-left">
                        <h4>代理申请管理<small id="gameName">四川麻将会员代理后台</small></h4>
                    </div>
                </div>
            </div>
            <form id="form_list" action="" method="get">
                <input type="hidden" name="page" value="{{.page.page}}">
                <input type="hidden" name="status" value="{{.status}}">
            </form>

            <div class="layui-tab" lay-filter="apply_tab">
                <ul class="layui-tab-title">
                    <li data-status="1" {{if eq .status 1}}class="layui-this"{{end}}>待审核</li>
                    <li data-status="3" {{if eq .status 3}}class="layui-this"{{end}}>已通过</li>
                    <li data-status="2" {{if eq .status 2}}class="layui-this"{{end}}>已拒绝</li>
                </ul>
                <div class="layui-tab-content">
                    <div class="layui-tab-item layui-show">
                        <table class="layui-table">
                            <thead>
                            <tr>
                                <th>Id</th>
                                <th>游戏id</th>
                                <th>姓名</th>
                                <th>电话</th>
                                <th>状态</th>
                                <th>请求时间</th>
                                {{if ne .status 1}}
                                <th>处理时间</th>
                                {{end}}
                                {{if eq .status 1}}
                                <th>操作</th>
                                {{end}}
                            </tr>
                            </thead>
                            <tbody>
                            {{range $k,$v := .list}}
                            <tr>
                                <td>{{$v.Id.Hex}}</td>
                                <td>{{$v.UserId}}</td>
                                <td>{{$v.Name}}</td>
                                <td>{{$v.Phone}}</td>
                                <td>{{$v.Status.Name}}</td>
                                <td>{{$v.RequestTime.Format "2006-01-02 15:04:05"}}</td>
                                {{if ne $v.Status 1}}
                                <td>{{$v.ProcessTime.Format "2006-01-02 15:04:05"}}</td>
                                {{end}}
                                {{if eq $v.Status 1}}
                                <td>
                                    <form class="layui-form" action="">
                                        <div class="layui-form-item">
                                            <div class="layui-input-inline">
                                                <select class="select_status" lay-filter="status" data-id="{{$v.Id.Hex}}" name="status">
                                                    <option value="">操作</option>
                                                    <option value="2">拒绝</option>
                                                    <option value="3">通过</option>
                                                </select>
                                            </div>
                                        </div>
                                    </form>
                                </td>
                                {{end}}
                            </tr>
                            {{end}}
                            </tbody>
                        </table>
                        <div style="height: 35px;width: 750px;">
                            <div id="view_page"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="/static/weixin/js/slide_menu.js"></script>
<script src="/static/weixin/js/share.js"></script>
<script type="text/javascript">
    $("title").html("代理申请管理");

    layui.use(["laypage","laydate", "form", "element"], function () {
        //选项卡
        layui.element().on("tab(apply_tab)", function(ele){
            window.location.href = "/weixin/agent/apply/log?status="+this.getAttribute("data-status")
        });

        var form = layui.form();
        form.on('select(status)', function (data) {
            var val = data.value;
            var elem = data.elem;
            var id = $(elem).data("id");
            if(window.confirm("确定执行该操作吗？")){
                $.ajax({
                    url:"/weixin/agent/apply/switch",
                    type:"get",
                    data:{"id": id, "status": val},
                    success: function (res) {
                        if(window.confirm(res.msg)){
                            window.location.reload();
                        }
                    }
                });
            }
        });

        layui.laypage({
            cont: 'view_page',
            pages: {{.page.page_count}}, //总页数
        curr: {{.page.page}},
        skip:true, //连续显示分页数
            jump: function (obj) {
            var page = $("#form_list").find("[name=page]");
            if(page.val() != obj.curr) {
                page.val(obj.curr);
                $("#form_list").submit();
            }
        }
    });

    });

</script>


{{ template "weixin_footer" }}
