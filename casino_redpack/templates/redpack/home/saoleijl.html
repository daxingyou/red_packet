
<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>扫雷</title>
    <link rel="stylesheet" type="text/css" href="/static/home/css/aui.css" />
    <link rel="stylesheet" type="text/css" href="/static/home/css/member.css" />

    <link rel="stylesheet" type="text/css" href="/static/home/css/layer.css" />
    <link rel="stylesheet" type="text/css" href="/static/home/css/saoleijl.css" />

    <style type="text/css">
        .gonggao{
            width: 100%;
            height: 45px;
            top: 6.5rem;
            position: absolute;
            background-color:rgba(0,0,0,0.5);
        }
        .gonggao>marquee{
            color: #fff;
            font-size: 18px;
            line-height: 45px;
        }
        .kf{

            height: 20px;
            top: 6.5rem;
            position: absolute;

            color: #fff;
            font-size: 18px;
            line-height: 45px;
        }
    </style>

</head>
<body>
{{/*<div class="gonggao" style="z-index: 999999">*/}}
    {{/*<marquee behavior="scroll" contenteditable="true" onstart="this.firstChild.innerHTML+=this.firstChild.innerHTML;" scrollamount="3" width="100%" onmouseover="this.stop();" onmouseout="this.start();">*/}}
        {{/*本游戏仅供测试、仅供娱乐，严禁赌博，如出现赌博行为，将封停账号并向公安机关举报 ！*/}}
    {{/*</marquee>*/}}
{{/*</div>*/}}
<img src="/static/home/image/big-bg.png" style="width: 100%;height: 100%;position: fixed;z-index: -5;">


<div class="aui-content" style="top:0px; position: fixed;width: 100%;z-index: 999">
    <div class="header" style="background-size: 100% 100%;">
        <div class="facico"><img id="headimgurl" src="" onerror="this.src='/static/home/image/noface.png'" /></div>
        <div class="user">
            <p class="user-name" id="nickname">加载中</p>
            <p class="user-id">( ID:<span id="userid">加载中</span> )</p>
        </div>
        <div class="gold-sum">
            <p class="gold">金币<span style="font-size: 0.6rem" id="money">加载中</span></p>
            {{/*<a class= "gold" href="http://t.ibangkf.com/i/chat-a2954573.html?l=a2954573"><span style="font-size: 0.8	rem; margin-top:20px;margin-right:5px;">→在线客服-*/}}
{{/*</span></a>*/}}
        </div>



    </div>
</div>


<div class="aui-content"  style="margin-top: 3.4rem;">
    <div class="header-bottom1">
        <img src="/static/home/image/beijing.png">
        <img src="/static/home/image/new_saolei.png" alt="">
    </div>
</div>


<div class="aui-card-list-content" style="padding-bottom: 5.5rem;">
    <ul class="saoleijl" id="item" style="z-index: 1;">
    </ul>
</div>
<div id="zz" class="layui-m-layershade" style="z-index: 1;display: none;"></div>
<div id="kaihongbao" class="layui-m-layermain saoleijl" style="z-index: 9999;display: none;">
    <div class="layui-m-layersection hb layui-m-layerchild dialog_hb layui-m-anim-scale">
        <img onclick="closes()" src="/static/home/image/gb.png" alt="" class="guan"/>
        <img id="fbr_img" src="" alt="" class="hb-tx"/>
        <p id="fbr_nickname"></p>
        <p>发了一个红包，金额随机</p>
        <p id="smo">恭喜发财，大吉大利</p>
        <img onclick="kai()" src="/static/home/image/kai.png" alt="" class="kai"/>
        <img src="/static/home/image/hua.png" alt="" class="hua"/>
        <input name="redId" id="redIdaa" type="hidden" value=""  />
    </div>
</div>


<div class="foot-top">
    <div><a href="/home/saoleijl/add"><img src="/static/home/image/button-fhb.png" alt=""></a></div>
    <div><img onclick="openDialog()"  src="/static/home/image/button-youxi.png" alt=""></div>
</div>


<footer class="aui-bar aui-bar-tab" id="footer" style="background-color: #fff;">
    <div class="aui-bar-tab-item aui-active" tapmode>
        <a href="/home">
            <i class="aui-iconfont aui-img-21"><img src="/static/home/image/qhh-icon.png" /></i>
            <div class="aui-bar-tab-label aui-text-huangs">抢红包</div>
        </a>
    </div>
    <div class="aui-bar-tab-item" tapmode>
        <a href="/home/member/recharge">
            <i class="aui-iconfont aui-img-21"><img src="/static/home/image/cz-icon.png" /></i>
            <div class="aui-bar-tab-label aui-text-huangs">充值</div>
        </a>
    </div>
    <div class="aui-bar-tab-item" tapmode>
        <a href="/home/member/outred">
            <i class="aui-iconfont aui-img-21"><img src="/static/home/image/fhb-icon.png" /></i>
            <div class="aui-bar-tab-label aui-text-huangs">微信提现</div>
        </a>
    </div>
    <div class="aui-bar-tab-item" tapmode>
        <a href="/home/member/record">
            <i class="aui-iconfont aui-img-21"><img src="/static/home/image/yxjl-icon.png" /></i>
            <div class="aui-bar-tab-label aui-text-huangs">游戏记录</div>
        </a>
    </div>
    <div class="aui-bar-tab-item" tapmode>
        <a href="/home/member/agent">
            <i class="aui-iconfont aui-img-21"><img src="/static/home/image/dlzx-icon.png" /></i>
            <div class="aui-bar-tab-label aui-text-huangs">代理中心</div>
        </a>
    </div>
</footer>

<script type="text/javascript" src="/static/home/script/jquery-3.2.1.min.js" ></script>

<script type="text/javascript" src="/static/home/script/layer.js" ></script>
<script type="text/javascript">
    function openDialog() {
        layer.open({
            className: 'dialog_hb', //这样你就可以在css里面控制该弹层的风格了
            content: '扫雷无免死，金币比例1：1<br>包数为：5-10包<br>倍数为：5包2倍    6包1.7倍   7包1.5倍  8包1.3倍<br>  9包1.2倍  10包1.1倍<br>雷数为：0-9任意数字<br>发包者设置雷数，抢包者抢到的金额最后一位数字与雷的数字相同，即为中雷！不相同，即为不中雷！发包后自动扣除相对应的金币，有人中雷回自动返还相应赔率的金币<br>不中雷会自动增加所抢金币，抢包中雷回自动扣除相对应赔率的金币<br>奖励制度<br>顺子（1.23～7.89）奖励6.88金币<br>豹子（1.11～9.99）奖励10金币<br>顺子（12.34～67.89）奖励38.88金币<br>豹子（11.11～99.99）奖励58.88金币<br>顺子（123.45～567.89）奖励388金币<br>豹子（111.11～999.99）奖励588金币<br>5.20奖励18.88金币<br>13.14奖励18.88金币<br>0.01奖励18.88金币<br>20.18奖励18.88金币'
            ,btn: '我知道了'
        });
    }
    function kai() {
        var redId=$("#redIdaa").val();
//        setInterval("kailo("+redId+")", 1000);
        kailo(redId);
    }
    function kailo(redId) {
        $.get("/home/jlindex/join_open_red_packet?redId="+redId+'&Type=5',function(data,status){
            if(status=='success'){
                var dataObj=eval("("+data+")");//转换为json对象
                var code=dataObj.code;
                var codes=dataObj.request.code;
                if(codes=='0'){
                    $("#kaihongbao").hide();
                    $("#zz").hide();
                    layer.open({
                        content: dataObj.request.msg
                        ,btn: '我知道了'
                    });
                    //todo 修改点
                    // $("#item").html('');
                    // ids='00';
                    // shuju();
                    return;
                }
                if(code=='0'){
                    tiaozhuan(redId,1);
                }else{
                    tiaozhuan(redId,0);
                }
            }
        })
    }
    function closes() {
        $("#kaihongbao").hide();
        $("#zz").hide();
    }
    function add(redId,fbr_img,fbr_nickname,jinbi,lei,jiaru) {
        var fbr_img,fbr_nickname,smo;
        if(jiaru=='1'){
            tiaozhuan(redId,1);
//            $(location).attr('href', '/home/saoleijl/kai_ok?lq=1&redId='+redId);
            return;
        }
        $("#fbr_img").attr('src',fbr_img);
        $("#fbr_nickname").html(decodeURI(fbr_nickname));
        var smo=jinbi+'金币 |雷：'+lei;
        $("#smo").html(smo);
        $("#kaihongbao").show();
        $("#zz").show();
        $("#redIdaa").val(redId);
    }
    $("#item").html('');
    var ids='00';
    var url='/home/jlindex/getRedPacketList';

    //todo 注释掉自动拉取数据
    // shuju();
    // setInterval("shuju()", 2000);

    function shuju(){
        $.post(url,{ type:"5",ids: ids },function(data,status){
            if(status=='success'){
                var dataObj=eval("("+data+")");//转换为json对象
                var request=dataObj.request;
                if(request!=='0'){
                    $.each(dataObj.request,function(i,item){
                        ids=ids+','+item.id;
                        var hbzt,hbpic,hbys,xszt;
                        if(item.jiaru=='0'){
                            hbzt='领取红包';
                            hbpic='hb.png';
                            hbys='';
                            xszt='1';
                        }else{
                            hbzt='红包已领取';
                            hbpic='hbk.png';
                            hbys=' blur';
                            xszt='0';
                        }
                        if(xszt=='1'){
                            if(item.xianshi=='0'){
                                $("#item").append('<li class="content">' +
                                        '<img src="'+item.headimgurl+'" alt="" class="tx"/>' +
                                        '<div onclick=add('+item.id+',"'+item.headimgurl+'","'+encodeURI(item.nickname)+'","'+item.moneyfa+'","'+item.tail_number+'","'+item.jiaru+'") class="content-r">' +
                                        '<p class="user-id">'+item.nickname+'</p>' +
                                        '<div class="content-rb '+hbys+'"><div class="content-rbt"><img src="/static/home/image/'+hbpic+'" alt="" />' +
                                        '<p>'+item.moneyfa+'金币|雷:'+item.tail_number+'</p>' +
                                        '<p>'+hbzt+'</p>' +
                                        '</div><div class="content-rbb">' +
                                        '<p>天赐良包</p>' +
                                        '</div><div class="arrow"></div></div></div></li>');
                            }else{
                                $("#item").append('<li class="content">' +
                                        '<img src="'+item.headimgurl+'" alt="" class="tx f-lit r-tx"/>' +
                                        '<div onclick=add('+item.id+',"'+item.headimgurl+'","'+encodeURI(item.nickname)+'","'+item.moneyfa+'","'+item.tail_number+'","'+item.jiaru+'") class="content-r">' +
                                        '<p class="user-id r-user-id">'+item.nickname+'</p>' +
                                        '<div class="content-rb f-lit '+hbys+'"><div class="content-rbt"><img src="/static/home/image/'+hbpic+'" alt="" />' +
                                        '<p>'+item.moneyfa+'金币|雷:'+item.tail_number+'</p>' +
                                        '<p>'+hbzt+'</p>' +
                                        '</div><div class="content-rbb">' +
                                        '<p>天赐良包</p>' +
                                        '</div><div class="r-arrow"></div></div></div></li>');
                            }
                        }
                    });
                }
                lq_msg();
            }
        });
    }
    function lq_msg() {
        var urls='/home/jlindex/getRedPacketlqList?type=5';
        $.get(urls,function(data,status){
            if(status=='success'){
                var dataObj_msg=eval("("+data+")");//转换为json对象
                var request=dataObj_msg.request;
                if(request!=='0'){
                    $.each(dataObj_msg.request,function(i,item){
                        $("#item").append('<li class="lqhbts-b">' +
                                '<div class="lqhbts"><img src="/static/home/image/hb.png" alt=""><p>'+
                                '<span>'+item.nickname+'</span>'+
                                '领取了你的红包</p></div></li>');
                    });
                }
            }
        })
    }
    //判断客户端型号
    function tiaozhuan(redId,lq) {
        var u = navigator.userAgent;
        if(!!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)){
            $(location).attr('href', '/home/saoleijl/kai_ok?lq='+lq+'&redId='+redId);
        }else{
            $(location).attr('href', '/home/saoleijl/kai_ok?lq='+lq+'&redId='+redId);
            // $(location).attr('href', '/home/saoleijl/kai_okaz?lq='+lq+'&redId='+redId);
        }
    }

    //websocket
    var ws_dial = function () {
        var ws = new WebSocket("ws://"+location.host+"/ws/redpack/room/10000");
        ws.onopen = ws_on_open;
        ws.onmessage = ws_on_msg;
        ws.onclose = ws_on_close;
    };
    var ws_on_open = function (ev) {
        $("#item").html('');
    };
    var ws_on_msg = function (ev) {
        var data = ev.data;
        var dataObj=eval("("+data+")");//转换为json对象
        var request=dataObj.request;
        if(request!=='0'){

            var need_score = false;
            //滚动到最底部
            if($("#item").html() == ""){
                need_score = true;
            }

            $.each(dataObj.request,function(i,item){
                ids=ids+','+item.id;
                var hbzt,hbpic,hbys,xszt;
                if(item.jiaru=='0'){
                    hbzt='领取红包';
                    hbpic='hb.png';
                    hbys='';
                    xszt='1';
                }else if(item.jiaru=='1'){
                    hbzt='红包已领取';
                    hbpic='hbk.png';
                    hbys=' blur';
                    xszt='0';
                }else {
                    hbzt='红包已领完';
                    hbpic='hbk.png';
                    hbys=' blur';
                }
                if(true){
                    if(item.is_self=='0'){
                        $("#item").append('<li class="content">' +
                                '<img src="'+item.headimgurl+'" alt="" class="tx"/>' +
                                '<div onclick=add('+item.id+',"'+item.headimgurl+'","'+encodeURI(item.nickname)+'","'+item.moneyfa+'","'+item.tail_number+'","'+item.jiaru+'") class="content-r">' +
                                '<p class="user-id">'+item.nickname+'</p>' +
                                '<div class="content-rb '+hbys+'"><div class="content-rbt"><img src="/static/home/image/'+hbpic+'" alt="" />' +
                                '<p>'+item.moneyfa+'金币|雷:'+item.tail_number+'</p>' +
                                '<p>'+hbzt+'</p>' +
                                '</div><div class="content-rbb">' +
                                '<p>天赐良包</p>' +
                                '</div><div class="arrow"></div></div></div></li>');
                    }else{
                        $("#item").append('<li class="content">' +
                                '<img src="'+item.headimgurl+'" alt="" class="tx f-lit r-tx"/>' +
                                '<div onclick=add('+item.id+',"'+item.headimgurl+'","'+encodeURI(item.nickname)+'","'+item.moneyfa+'","'+item.tail_number+'","'+item.jiaru+'") class="content-r">' +
                                '<p class="user-id r-user-id">'+item.nickname+'</p>' +
                                '<div class="content-rb f-lit '+hbys+'"><div class="content-rbt"><img src="/static/home/image/'+hbpic+'" alt="" />' +
                                '<p>'+item.moneyfa+'金币|雷:'+item.tail_number+'</p>' +
                                '<p>'+hbzt+'</p>' +
                                '</div><div class="content-rbb">' +
                                '<p>天赐良包</p>' +
                                '</div><div class="r-arrow"></div></div></div></li>');
                    }
                }
            });

            //滚动到最底部
            if(need_score){
                console.log(need_score);
                $(document).scrollTop($(document).height());
            }
        }
    };
    var ws_on_close = function () {
        setTimeout(function () {
            ws_dial();
        }, 1000);
    };
    ws_dial();
</script>


<script type="text/javascript">
    $(document).ready(function(){
        $.get("/home/login/getMemberInfo",function(data,status){
            if(status=='success'){
                var dataObj=eval("("+data+")");//转换为json对象
                var code=dataObj.code;
                if(code=='1'){
                    // if(dataObj.request.username==''){
                    //     $(location).attr('href', '/home/login/usernameset');
                    // }
                    $("#money").html(dataObj.request.golds);
                    $("#headimgurl").attr('src',dataObj.request.headimgurl);
                    $("#nickname").html(dataObj.request.nickname);
                    $("#userid").html(dataObj.request.id);
                    $("#zxrs").html(dataObj.request.numberOnline);
                }
            }
        });
    });
</script>

<script type="text/javascript">
    /**
     * 时间戳转换日期
     * @param <int> unixTime  待时间戳(秒)
     * @param <bool> isFull  返回完整时间(Y-m-d 或者 Y-m-d H:i:s)
     */
    function formatDate(unixTime, type) {
        var time = new Date(unixTime * 1000);
        var year=time.getUTCFullYear();
        var month=time.getUTCMonth()+1;
        var date=time.getUTCDate();
        var hour=getzf(time.getHours());
        var minute=getzf(time.getMinutes());
        var second=getzf(time.getUTCSeconds());
        switch(type){
            case 1:
                return hour+":"+minute+":"+second;
            case 2:
                return month+"-"+date+" "+hour+":"+minute;
            default:
                return year+"-"+month+"-"+date+" "+hour+":"+minute+":"+second;
        }
    }
    //补0操作
    function getzf(num){
        if(parseInt(num) < 10){
            num = '0'+num;
        }
        return num;
    }
</script>
</body>
</html>
